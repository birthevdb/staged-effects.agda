<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Staged.Lang</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--type-in-type</a> <a id="28" class="Pragma">--overlapping-instances</a> <a id="52" class="Symbol">#-}</a>

<a id="57" class="Keyword">module</a> <a id="64" href="Staged.Lang.html" class="Module">Staged.Lang</a> <a id="76" class="Keyword">where</a>

<a id="83" class="Keyword">open</a> <a id="88" class="Keyword">import</a> <a id="95" href="Function.html" class="Module">Function</a>

<a id="105" class="Keyword">open</a> <a id="110" class="Keyword">import</a> <a id="117" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="126" class="Keyword">open</a> <a id="131" class="Keyword">import</a> <a id="138" href="Data.Sum.html" class="Module">Data.Sum</a>
<a id="147" class="Keyword">open</a> <a id="152" class="Keyword">import</a> <a id="159" href="Data.Maybe.html" class="Module">Data.Maybe</a>
<a id="170" class="Keyword">open</a> <a id="175" class="Keyword">import</a> <a id="182" href="Data.List.html" class="Module">Data.List</a>
<a id="192" class="Keyword">open</a> <a id="197" class="Keyword">import</a> <a id="204" href="Data.Product.html" class="Module">Data.Product</a>

<a id="218" class="Keyword">open</a> <a id="223" class="Keyword">import</a> <a id="230" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>


<a id="270" class="Comment">-- Step 1: import basic library functionality</a>
<a id="316" class="Keyword">open</a> <a id="321" class="Keyword">import</a> <a id="328" href="Staged.Denote.html" class="Module">Staged.Denote</a>

<a id="343" class="Comment">-- Step 2: import effects</a>
<a id="369" class="Keyword">open</a> <a id="374" class="Keyword">import</a> <a id="381" href="Staged.Effects.Nat.html" class="Module">Staged.Effects.Nat</a>
<a id="400" class="Keyword">open</a> <a id="405" class="Keyword">import</a> <a id="412" href="Staged.Effects.State.html" class="Module">Staged.Effects.State</a>
<a id="433" class="Keyword">open</a> <a id="438" class="Keyword">import</a> <a id="445" href="Staged.Effects.Lambda.html" class="Module">Staged.Effects.Lambda</a>
<a id="467" class="Keyword">open</a> <a id="472" class="Keyword">import</a> <a id="479" href="Staged.Effects.NoOp.html" class="Module">Staged.Effects.NoOp</a>

<a id="500" class="Comment">-- Step 3: import object language constructors</a>
<a id="547" class="Keyword">open</a> <a id="552" class="Keyword">import</a> <a id="559" href="Staged.Expression.Nat.html" class="Module">Staged.Expression.Nat</a>
<a id="581" class="Keyword">open</a> <a id="586" class="Keyword">import</a> <a id="593" href="Staged.Expression.State.html" class="Module">Staged.Expression.State</a> <a id="617" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
<a id="619" class="Keyword">open</a> <a id="624" class="Keyword">import</a> <a id="631" href="Staged.Expression.Lambda.html" class="Module">Staged.Expression.Lambda</a>

<a id="657" class="Comment">-- Step 4: assemble eDSL</a>
<a id="682" class="Keyword">module</a> <a id="689" href="Staged.Lang.html#689" class="Module">_</a> <a id="691" class="Keyword">where</a>

  <a id="700" class="Comment">-- Choose a value type</a>
  <a id="725" class="Keyword">data</a> <a id="730" href="Staged.Lang.html#730" class="Datatype">Val</a> <a id="734" class="Symbol">:</a> <a id="736" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="740" class="Keyword">where</a>
    <a id="750" href="Staged.Lang.html#750" class="InductiveConstructor">vnat</a>  <a id="756" class="Symbol">:</a> <a id="758" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="760" class="Symbol">→</a> <a id="762" href="Staged.Lang.html#730" class="Datatype">Val</a>
    <a id="770" href="Staged.Lang.html#770" class="InductiveConstructor">vclos</a> <a id="776" class="Symbol">:</a> <a id="778" href="Staged.Effects.Lambda.html#1555" class="Datatype">Closure</a> <a id="786" href="Staged.Lang.html#730" class="Datatype">Val</a> <a id="790" class="Symbol">→</a> <a id="792" href="Staged.Lang.html#730" class="Datatype">Val</a>

  <a id="799" class="Keyword">instance</a> <a id="808" href="Staged.Lang.html#808" class="Function">ℕ⊂Val</a> <a id="814" class="Symbol">:</a> <a id="816" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="818" href="Staged.Value.Core.html#125" class="Record Operator">⊂</a> <a id="820" href="Staged.Lang.html#730" class="Datatype">Val</a>
  <a id="826" href="Staged.Value.Core.html#166" class="Field">_⊂_.inject</a> <a id="837" href="Staged.Lang.html#808" class="Function">ℕ⊂Val</a> <a id="843" class="Symbol">=</a> <a id="845" href="Staged.Lang.html#750" class="InductiveConstructor">vnat</a>
  <a id="852" href="Staged.Value.Core.html#194" class="Field">_⊂_.project</a> <a id="864" href="Staged.Lang.html#808" class="Function">ℕ⊂Val</a> <a id="870" class="Symbol">(</a><a id="871" href="Staged.Lang.html#750" class="InductiveConstructor">vnat</a> <a id="876" href="Staged.Lang.html#876" class="Bound">x</a><a id="877" class="Symbol">)</a> <a id="879" class="Symbol">=</a> <a id="881" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a> <a id="886" href="Staged.Lang.html#876" class="Bound">x</a>
  <a id="890" href="Staged.Value.Core.html#194" class="Field">_⊂_.project</a> <a id="902" href="Staged.Lang.html#808" class="Function">ℕ⊂Val</a> <a id="908" class="Symbol">(</a><a id="909" href="Staged.Lang.html#770" class="InductiveConstructor">vclos</a> <a id="915" href="Staged.Lang.html#915" class="Bound">x</a><a id="916" class="Symbol">)</a> <a id="918" class="Symbol">=</a> <a id="920" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a>

  <a id="931" class="Keyword">instance</a> <a id="940" href="Staged.Lang.html#940" class="Function">Closure⊂Val</a> <a id="952" class="Symbol">:</a> <a id="954" href="Staged.Effects.Lambda.html#1555" class="Datatype">Closure</a> <a id="962" href="Staged.Lang.html#730" class="Datatype">Val</a> <a id="966" href="Staged.Value.Core.html#125" class="Record Operator">⊂</a> <a id="968" href="Staged.Lang.html#730" class="Datatype">Val</a>
  <a id="974" href="Staged.Value.Core.html#166" class="Field">_⊂_.inject</a> <a id="985" href="Staged.Lang.html#940" class="Function">Closure⊂Val</a> <a id="997" class="Symbol">=</a> <a id="999" href="Staged.Lang.html#770" class="InductiveConstructor">vclos</a>
  <a id="1007" href="Staged.Value.Core.html#194" class="Field">_⊂_.project</a> <a id="1019" href="Staged.Lang.html#940" class="Function">Closure⊂Val</a> <a id="1031" class="Symbol">(</a><a id="1032" href="Staged.Lang.html#750" class="InductiveConstructor">vnat</a> <a id="1037" href="Staged.Lang.html#1037" class="Bound">x</a><a id="1038" class="Symbol">)</a> <a id="1040" class="Symbol">=</a> <a id="1042" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a>
  <a id="1052" href="Staged.Value.Core.html#194" class="Field">_⊂_.project</a> <a id="1064" href="Staged.Lang.html#940" class="Function">Closure⊂Val</a> <a id="1076" class="Symbol">(</a><a id="1077" href="Staged.Lang.html#770" class="InductiveConstructor">vclos</a> <a id="1083" href="Staged.Lang.html#1083" class="Bound">x</a><a id="1084" class="Symbol">)</a> <a id="1086" class="Symbol">=</a> <a id="1088" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a> <a id="1093" href="Staged.Lang.html#1083" class="Bound">x</a>


  <a id="1099" class="Comment">-- Compose Expression type</a>
  <a id="1128" href="Staged.Lang.html#1128" class="Function">Expr</a>   <a id="1135" class="Symbol">=</a> <a id="1137" href="Staged.Expression.Nat.html#183" class="Function">NatExpr</a> <a id="1145" href="Staged.Denote.Sig.html#943" class="Function Operator">∪</a> <a id="1147" href="Staged.Expression.State.html#311" class="Function">StateExpr</a> <a id="1157" href="Staged.Denote.Sig.html#943" class="Function Operator">∪</a> <a id="1159" href="Staged.Expression.Lambda.html#284" class="Function">LamExpr</a> 


  <a id="1172" class="Comment">-- Compose effect signature</a>
  <a id="1202" href="Staged.Lang.html#1202" class="Function">LamSig</a> <a id="1209" class="Symbol">=</a> <a id="1211" href="Staged.Effects.Nat.html#434" class="Function">NatOpSig</a> <a id="1220" href="Staged.Lang.html#730" class="Datatype">Val</a> <a id="1224" href="Staged.Denote.StagedSig.html#461" class="Function Operator">⊞</a> <a id="1226" href="Staged.Effects.State.html#465" class="Function">StateSig</a> <a id="1235" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1237" href="Staged.Denote.StagedSig.html#461" class="Function Operator">⊞</a> <a id="1239" href="Staged.Effects.Lambda.html#807" class="Function">LamOpSig</a> <a id="1248" href="Staged.Lang.html#730" class="Datatype">Val</a> <a id="1252" href="Staged.Denote.StagedSig.html#461" class="Function Operator">⊞</a> <a id="1254" href="Staged.Effects.NoOp.html#122" class="Function">NoOpSig</a>


  <a id="1266" class="Comment">-- Build semantic function</a>
  <a id="1295" href="Staged.Lang.html#1295" class="Function Operator">⟦_⟧</a> <a id="1299" class="Symbol">:</a> <a id="1301" href="Staged.Denote.Sig.html#489" class="Datatype">μ</a> <a id="1303" href="Staged.Lang.html#1128" class="Function">Expr</a> <a id="1308" class="Symbol">→</a> <a id="1310" href="Staged.Denote.Tree.html#223" class="Datatype">Tree</a> <a id="1315" href="Function.Base.html#615" class="Function">id</a> <a id="1318" href="Staged.Lang.html#1202" class="Function">LamSig</a> <a id="1325" href="Staged.Lang.html#730" class="Datatype">Val</a>
  <a id="1331" href="Staged.Lang.html#1295" class="Function Operator">⟦_⟧</a> <a id="1335" class="Symbol">=</a> <a id="1337" href="Staged.Denote.Tree.html#1510" class="Function Operator">⟪</a> <a id="1339" href="Staged.Expression.Nat.html#270" class="Function">⟦nat⟧</a> <a id="1345" href="Staged.Denote.Tree.html#1611" class="Function Operator">`⊙</a> <a id="1348" href="Staged.Expression.State.html#495" class="Function">⟦state⟧</a> <a id="1356" href="Staged.Denote.Tree.html#1611" class="Function Operator">`⊙</a> <a id="1359" href="Staged.Expression.Lambda.html#581" class="Function">⟦lambda⟧</a> <a id="1368" href="Staged.Denote.Tree.html#1510" class="Function Operator">⟫</a>

  <a id="1373" class="Comment">-- Define handler application</a>
  <a id="1405" href="Staged.Lang.html#1405" class="Function">operate</a> <a id="1413" class="Symbol">:</a> <a id="1415" href="Staged.Denote.Tree.html#223" class="Datatype">Tree</a> <a id="1420" href="Function.Base.html#615" class="Function">id</a> <a id="1423" href="Staged.Lang.html#1202" class="Function">LamSig</a> <a id="1430" href="Staged.Lang.html#730" class="Datatype">Val</a> <a id="1434" class="Symbol">→</a> <a id="1436" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="1438" class="Symbol">→</a> <a id="1440" href="Data.Maybe.Base.html#838" class="Datatype">Maybe</a> <a id="1446" href="Staged.Lang.html#730" class="Datatype">Val</a>
  <a id="1452" href="Staged.Lang.html#1405" class="Function">operate</a> <a id="1460" href="Staged.Lang.html#1460" class="Bound">x</a> <a id="1462" href="Staged.Lang.html#1462" class="Bound">n</a> <a id="1464" class="Keyword">with</a> <a id="1469" href="Staged.Effects.Lambda.html#2173" class="Function">hLam&#39;</a> <a id="1475" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="1478" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="1481" href="Staged.Lang.html#1462" class="Bound">n</a> <a id="1483" class="Symbol">(</a><a id="1484" href="Staged.Effects.State.html#624" class="Function">hSt&#39;&#39;</a> <a id="1490" class="Number">0</a> <a id="1492" class="Symbol">(</a><a id="1493" href="Staged.Effects.Nat.html#633" class="Function">hNat&#39;</a> <a id="1499" href="Staged.Lang.html#1460" class="Bound">x</a><a id="1500" class="Symbol">))</a>
  <a id="1505" class="Symbol">...</a> <a id="1509" class="Symbol">|</a> <a id="1511" href="Staged.Denote.Tree.html#288" class="InductiveConstructor">leaf</a> <a id="1516" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a>              <a id="1537" class="Symbol">=</a> <a id="1539" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a>
  <a id="1549" class="Symbol">...</a> <a id="1553" class="Symbol">|</a> <a id="1555" href="Staged.Denote.Tree.html#288" class="InductiveConstructor">leaf</a> <a id="1560" class="Symbol">(</a><a id="1561" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a> <a id="1566" class="Symbol">(_</a> <a id="1569" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1571" class="Symbol">_</a> <a id="1573" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1575" href="Staged.Lang.html#1575" class="Bound">snd</a><a id="1578" class="Symbol">))</a> <a id="1581" class="Symbol">=</a> <a id="1583" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a> <a id="1588" href="Staged.Lang.html#1575" class="Bound">snd</a>


<a id="1594" class="Comment">-- Step 5: profit</a>
<a id="1612" class="Keyword">module</a> <a id="1619" href="Staged.Lang.html#1619" class="Module">_</a> <a id="1621" class="Keyword">where</a> 

  <a id="1631" href="Staged.Lang.html#1631" class="Function">`x</a> <a id="1634" href="Staged.Lang.html#1634" class="Function">`y</a> <a id="1637" href="Staged.Lang.html#1637" class="Function">`z</a> <a id="1640" href="Staged.Lang.html#1640" class="Function">`u</a> <a id="1643" href="Staged.Lang.html#1643" class="Function">`v</a> <a id="1646" href="Staged.Lang.html#1646" class="Function">`w</a> <a id="1649" class="Symbol">:</a> <a id="1651" href="Staged.Effects.Lambda.html#626" class="Function">Name</a>
  <a id="1658" href="Staged.Lang.html#1631" class="Function">`x</a> <a id="1661" class="Symbol">=</a> <a id="1663" class="Number">0</a>
  <a id="1667" href="Staged.Lang.html#1634" class="Function">`y</a> <a id="1670" class="Symbol">=</a> <a id="1672" class="Number">1</a>
  <a id="1676" href="Staged.Lang.html#1637" class="Function">`z</a> <a id="1679" class="Symbol">=</a> <a id="1681" class="Number">2</a>
  <a id="1685" href="Staged.Lang.html#1640" class="Function">`u</a> <a id="1688" class="Symbol">=</a> <a id="1690" class="Number">3</a>
  <a id="1694" href="Staged.Lang.html#1643" class="Function">`v</a> <a id="1697" class="Symbol">=</a> <a id="1699" class="Number">4</a>
  <a id="1703" href="Staged.Lang.html#1646" class="Function">`w</a> <a id="1706" class="Symbol">=</a> <a id="1708" class="Number">5</a>

  <a id="1713" href="Staged.Lang.html#1713" class="Function">example₀</a> <a id="1722" class="Symbol">:</a> <a id="1724" href="Staged.Denote.Sig.html#489" class="Datatype">μ</a> <a id="1726" href="Staged.Lang.html#1128" class="Function">Expr</a>
  <a id="1733" href="Staged.Lang.html#1713" class="Function">example₀</a> <a id="1742" class="Symbol">=</a> <a id="1744" href="Staged.Expression.Lambda.html#1307" class="Function">let&#39;</a> <a id="1749" href="Staged.Lang.html#1631" class="Function">`x</a> <a id="1752" class="Symbol">(</a><a id="1753" href="Staged.Expression.Lambda.html#1096" class="Function">abs&#39;</a> <a id="1758" href="Staged.Lang.html#1634" class="Function">`y</a> <a id="1761" class="Symbol">(</a><a id="1762" href="Staged.Expression.State.html#923" class="Function">put&#39;</a> <a id="1767" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1769" href="Staged.Expression.Nat.html#434" class="Function">nat&#39;</a> <a id="1774" class="Number">10</a><a id="1776" class="Symbol">)</a> <a id="1778" class="Symbol">)</a> <a id="1780" href="Function.Base.html#1919" class="Function Operator">$</a>
             <a id="1795" href="Staged.Expression.Lambda.html#1307" class="Function">let&#39;</a> <a id="1800" href="Staged.Lang.html#1637" class="Function">`z</a> <a id="1803" class="Symbol">(</a><a id="1804" href="Staged.Expression.Lambda.html#1190" class="Function">app&#39;</a> <a id="1809" class="Symbol">(</a><a id="1810" href="Staged.Expression.Lambda.html#1014" class="Function">var&#39;</a> <a id="1815" href="Staged.Lang.html#1631" class="Function">`x</a><a id="1817" class="Symbol">)</a> <a id="1819" class="Symbol">(</a><a id="1820" href="Staged.Expression.Lambda.html#1014" class="Function">var&#39;</a> <a id="1825" href="Staged.Lang.html#1631" class="Function">`x</a><a id="1827" class="Symbol">))</a>  <a id="1831" href="Function.Base.html#1919" class="Function Operator">$</a>
             <a id="1846" href="Staged.Expression.Lambda.html#1307" class="Function">let&#39;</a> <a id="1851" href="Staged.Lang.html#1640" class="Function">`u</a> <a id="1854" class="Symbol">(</a><a id="1855" href="Staged.Expression.Lambda.html#1190" class="Function">app&#39;</a> <a id="1860" class="Symbol">(</a><a id="1861" href="Staged.Expression.Lambda.html#1014" class="Function">var&#39;</a> <a id="1866" href="Staged.Lang.html#1631" class="Function">`x</a><a id="1868" class="Symbol">)</a> <a id="1870" class="Symbol">(</a><a id="1871" href="Staged.Expression.Lambda.html#1014" class="Function">var&#39;</a> <a id="1876" href="Staged.Lang.html#1631" class="Function">`x</a><a id="1878" class="Symbol">))</a>  <a id="1882" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1884" href="Staged.Expression.State.html#858" class="Function">get&#39;</a>


  <a id="1893" class="Comment">-- ut₀ : operate ⟦ example₀ ⟧ 20 ≡ {!!}</a>
  <a id="1935" class="Comment">-- ut₀ = refl</a>

  <a id="1952" class="Comment">-- example₁ : Expr</a>
  <a id="1973" class="Comment">-- example₁ =</a>
  <a id="1989" class="Comment">--   let&#39; 0 (lam 1 (plus (var 1) (var 1))) $</a>
  <a id="2036" class="Comment">--   call (var 0) (num 4)</a>

  <a id="2065" class="Comment">-- ut₁ : operate (denote example₁) ≡ just (numv 8)</a>
  <a id="2118" class="Comment">-- ut₁ = refl</a>

  <a id="2135" class="Comment">-- example₂ : Expr</a>
  <a id="2156" class="Comment">-- example₂ =</a>
  <a id="2172" class="Comment">--   let&#39; 0 (lam 1 (update (plus recall (num 1)))) $</a>
  <a id="2227" class="Comment">--   let&#39; 2 (lam 3 (update (plus recall (num 2)))) $</a>
  <a id="2282" class="Comment">--   let&#39; 4 (call (var 0) (num 0)) $</a>
  <a id="2321" class="Comment">--   let&#39; 5 (call (var 2) (num 0)) $</a>
  <a id="2360" class="Comment">--   recall</a>

  <a id="2375" class="Comment">-- ut₂ : operate (denote example₂) ≡ just (numv 3)</a>
  <a id="2428" class="Comment">-- ut₂ = refl</a>
  
</pre></body></html>